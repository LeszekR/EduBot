using System.Linq;
using System.Net;
using System.Web.Http;
using EduApi.DTO;
using System.Web.Http.Cors;
using EduApi.Dto.Mappers;

namespace EduApi.Controllers {


    // -------------------------------------------------------------------------------------------------
    [EnableCors(origins: "http://localhost:4200", headers: "*", methods: "*", SupportsCredentials = true)]
    public class LoginController : ApiController {


        [HttpPost]
        public IHttpActionResult Login([FromBody]Credentials cred) {

            var login = cred.Login;
            var passw = cred.Password;
            user userLog = null;

            using (edumaticEntities baza = new edumaticEntities()) {
                userLog = (from obiekt in baza.user
                           where obiekt.login == login && obiekt.password == passw
                           select obiekt).FirstOrDefault();
            }

            if (userLog == null)
                return StatusCode(HttpStatusCode.Unauthorized);
            else
                return Ok(UserMappper.GetDTO(userLog));
        }
    }
}